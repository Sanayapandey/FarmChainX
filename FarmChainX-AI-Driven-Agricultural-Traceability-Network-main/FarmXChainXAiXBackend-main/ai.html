<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Fruit Condition Analyzer Pro</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(145deg, #f7e1e9 0%, #d4f1f4 100%);
            min-height: 100vh;
            padding: 24px;
            line-height: 1.6;
        }

        .container {
            max-width: 1440px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
            color: white;
            padding: 48px 24px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 70%);
            opacity: 0.5;
            z-index: 0;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            font-size: 1.1rem;
            font-weight: 400;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .main-content {
            padding: 32px;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            background: #f1f3f5;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: default;
        }

        .step.active {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .step.completed {
            background: #e6f4ea;
            color: #2e7d32;
        }

        .step-number {
            background: white;
            color: #333;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .step.active .step-number {
            background: #fff3e0;
            color: #d81b60;
        }

        .content-section {
            background: #ffffff;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05);
        }

        .fruit-selection {
            text-align: center;
        }

        .fruit-selection h2,
        .condition-selector h3 {
            font-size: 1.75rem;
            font-weight: 600;
            color: #1a3c34;
            margin-bottom: 12px;
        }

        .fruit-selection p,
        .condition-selector p {
            color: #4b5e5a;
            font-size: 1rem;
            margin-bottom: 24px;
        }

        .fruit-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            max-width: 960px;
            margin: 24px auto;
        }

        .fruit-option {
            background: white;
            border: 2px solid transparent;
            border-radius: 16px;
            padding: 24px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .fruit-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .fruit-option:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .fruit-option:hover::before {
            opacity: 0.1;
        }

        .fruit-option.selected {
            border-color: #ff6b6b;
            background: linear-gradient(135deg, #fff3e0 0%, #ffebee 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(255, 107, 107, 0.3);
        }

        .fruit-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            display: block;
            transition: transform 0.3s ease;
        }

        .fruit-option:hover .fruit-icon {
            transform: scale(1.1);
        }

        .fruit-name {
            font-weight: 600;
            color: #1a3c34;
            font-size: 1.1rem;
        }

        .fruit-desc {
            font-size: 0.85rem;
            color: #6b7280;
        }

        .upload-section {
            text-align: center;
            border: 2px dashed #d1d5db;
            border-radius: 16px;
            padding: 32px;
            transition: all 0.3s ease;
        }

        .upload-section.dragover {
            border-color: #ff6b6b;
            background: #fff3e0;
        }

        .upload-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin: 24px 0;
            flex-wrap: wrap;
        }

        .upload-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(255, 107, 107, 0.3);
            background: linear-gradient(135deg, #ff8e53 0%, #ff6b6b 100%);
        }

        .upload-btn.secondary {
            background: linear-gradient(135deg, #34c0eb 0%, #1e88e5 100%);
        }

        .upload-btn.secondary:hover {
            box-shadow: 0 8px 16px rgba(33, 150, 243, 0.3);
            background: linear-gradient(135deg, #1e88e5 0%, #34c0eb 100%);
        }

        .image-preview {
            max-width: 100%;
            max-height: 360px;
            border-radius: 16px;
            margin: 24px 0;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .image-preview:hover {
            transform: scale(1.02);
        }

        .analysis-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-top: 24px;
        }

        .loading {
            text-align: center;
            padding: 48px;
            color: #4b5e5a;
        }

        .ai-spinner {
            width: 64px;
            height: 64px;
            margin: 0 auto 24px;
            position: relative;
        }

        .ai-spinner::before {
            content: '🤖';
            font-size: 2.5rem;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: pulse 1.5s infinite ease-in-out;
        }

        .ai-spinner::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ff6b6b;
            border-radius: 50%;
            animation: spin 1.2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.15); }
        }

        .metrics-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }

        .metric-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #ff6b6b, #34c0eb, #ffca28, #d81b60);
        }

        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
        }

        .metric-icon {
            font-size: 2rem;
            margin-bottom: 12px;
            display: block;
            color: #ff6b6b;
        }

        .metric-value {
            font-size: 2.25rem;
            font-weight: 700;
            margin: 12px 0;
            background: linear-gradient(135deg, #1a3c34 0%, #4b5e5a 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #6b7280;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .progress-container {
            position: relative;
            margin: 16px 0;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #f1f3f5;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 1s ease-in-out;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2.5s infinite linear;
        }

        @keyframes shimmer {
            0% { background-position: -300px 0; }
            100% { background-position: 300px 0; }
        }

        .rating {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }

        .rating.excellent { 
            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%); 
            color: white; 
        }
        .rating.good { 
            background: linear-gradient(135deg, #ff8e53 0%, #ff6b6b 100%); 
            color: white; 
        }
        .rating.average { 
            background: linear-gradient(135deg, #ffca28 0%, #ffb300 100%); 
            color: white; 
        }
        .rating.poor { 
            background: linear-gradient(135deg, #d81b60 0%, #c2185b 100%); 
            color: white; 
        }

        .insights-panel {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin: 24px 0;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05);
        }

        .insights-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f1f3f5;
        }

        .insights-header h3 {
            color: #1a3c34;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .insight-item {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f3f5 100%);
            border-left: 4px solid #ff6b6b;
            padding: 16px;
            margin: 12px 0;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .insight-item:hover {
            transform: translateX(8px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .insight-title {
            font-weight: 600;
            color: #1a3c34;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .insight-desc {
            color: #4b5e5a;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .confidence-score {
            text-align: center;
            background: linear-gradient(135deg, #34c0eb 0%, #1e88e5 100%);
            color: white;
            padding: 24px;
            border-radius: 16px;
            margin: 24px 0;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        .confidence-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 12px 0;
        }

        .condition-selector {
            margin: 32px 0;
            padding: 24px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.05);
        }

        .condition-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
        }

        .condition-card {
            background: white;
            border: 2px solid transparent;
            border-radius: 16px;
            padding: 20px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .condition-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #ff6b6b, #34c0eb);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .condition-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .condition-card:hover::before {
            opacity: 0.1;
        }

        .condition-card.selected {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .condition-card[data-condition="fresh"]:hover,
        .condition-card[data-condition="fresh"].selected {
            border-color: #4caf50;
            background: linear-gradient(135deg, #e6f4ea 0%, #f1f8e9 100%);
        }

        .condition-card[data-condition="aging"]:hover,
        .condition-card[data-condition="aging"].selected {
            border-color: #ff8e53;
            background: linear-gradient(135deg, #fff3e0 0%, #ffefdb 100%);
        }

        .condition-card[data-condition="stale"]:hover,
        .condition-card[data-condition="stale"].selected {
            border-color: #ffca28;
            background: linear-gradient(135deg, #fffbe6 0%, #fff8e1 100%);
        }

        .condition-card[data-condition="rotten"]:hover,
        .condition-card[data-condition="rotten"].selected {
            border-color: #d81b60;
            background: linear-gradient(135deg, #fce4ec 0%, #f8e8ee 100%);
        }

        .condition-icon {
            font-size: 2.25rem;
            margin-bottom: 12px;
            transition: transform 0.3s ease;
        }

        .condition-card:hover .condition-icon {
            transform: scale(1.1);
        }

        .condition-card h4 {
            color: #1a3c34;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .condition-card p {
            color: #6b7280;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .warning-banner {
            background: linear-gradient(135deg, #ffca28 0%, #ffb300 100%);
            color: #1a3c34;
            padding: 16px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
            animation: pulse-warning 2s infinite;
        }

        .danger-banner {
            background: linear-gradient(135deg, #d81b60 0%, #c2185b 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
            animation: pulse-danger 1.8s infinite;
            border: 2px solid #f06292;
        }

        @keyframes pulse-warning {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 202, 40, 0.6); }
            50% { box-shadow: 0 0 0 8px rgba(255, 202, 40, 0); }
        }

        @keyframes pulse-danger {
            0%, 100% { box-shadow: 0 0 0 0 rgba(216, 27, 96, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(216, 27, 96, 0); }
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }

            .header h1 {
                font-size: 1.75rem;
            }

            .header p {
                font-size: 0.95rem;
            }

            .analysis-section {
                grid-template-columns: 1fr;
            }

            .fruit-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }

            .condition-options {
                grid-template-columns: 1fr;
            }

            .upload-buttons {
                flex-direction: column;
                align-items: center;
                gap: 12px;
            }

            .upload-btn {
                width: 100%;
                max-width: 280px;
            }

            .metrics-dashboard {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .step-indicator {
                flex-direction: column;
                align-items: center;
            }

            .step {
                width: 100%;
                max-width: 240px;
                justify-content: center;
            }

            .fruit-selection h2,
            .condition-selector h3 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🍎 AI Fruit Analyzer Pro</h1>
            <p>Advanced Agricultural Quality Assessment with AI Vision</p>
        </div>

        <div class="main-content">
            <!-- Step Indicator -->
            <div class="step-indicator">
                <div class="step active" id="step1">
                    <div class="step-number">1</div>
                    <span>Select Fruit</span>
                </div>
                <div class="step" id="step2">
                    <div class="step-number">2</div>
                    <span>Upload Image</span>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <span>AI Analysis</span>
                </div>
                <div class="step" id="step4">
                    <div class="step-number">4</div>
                    <span>Results</span>
                </div>
            </div>

            <!-- Step 1: Fruit Selection -->
            <div class="content-section" id="fruitSelectionSection">
                <div class="fruit-selection">
                    <h2>🎯 Choose Your Fruit</h2>
                    <p>Select the fruit type for precise quality analysis</p>
                    
                    <div class="fruit-grid" id="fruitGrid"></div>

                    <!-- Freshness Condition Selector -->
                    <div class="condition-selector hidden" id="conditionSelector">
                        <h3>🔍 Select Fruit Condition</h3>
                        <p>Help us refine the analysis by specifying the fruit's condition</p>
                        
                        <div class="condition-options">
                            <div class="condition-card" data-condition="fresh" onclick="selectCondition('fresh')">
                                <div class="condition-icon">✨</div>
                                <h4>Fresh & New</h4>
                                <p>Vibrant, recently harvested</p>
                            </div>
                            
                            <div class="condition-card" data-condition="aging" onclick="selectCondition('aging')">
                                <div class="condition-icon">⚠️</div>
                                <h4>Aging</h4>
                                <p>Slightly soft or discolored</p>
                            </div>
                            
                            <div class="condition-card" data-condition="stale" onclick="selectCondition('stale')">
                                <div class="condition-icon">🚨</div>
                                <h4>Stale/Overripe</h4>
                                <p>Soft, dark spots, wrinkled</p>
                            </div>
                            
                            <div class="condition-card" data-condition="rotten" onclick="selectCondition('rotten')">
                                <div class="condition-icon">💀</div>
                                <h4>Rotten/Moldy</h4>
                                <p>Moldy or completely spoiled</p>
                            </div>
                        </div>
                    </div>
                    
                    <button class="upload-btn" id="proceedToUpload" style="margin-top: 24px; display: none;" onclick="proceedToStep2()">
                        Next: Upload Image →
                    </button>
                </div>
            </div>

            <!-- Step 2: Image Upload -->
            <div class="content-section hidden" id="imageUploadSection">
                <div class="upload-section" id="uploadSection">
                    <h2>📸 Upload Fruit Image</h2>
                    <p>Capture a clear photo of your <span id="selectedFruitName">fruit</span></p>
                    
                    <input type="file" id="fileInput" accept="image/*" style="display: none;">
                    
                    <div class="upload-buttons">
                        <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                            📷 Select Image
                        </button>
                        <button class="upload-btn secondary" onclick="captureImage()">
                            📸 Take Photo
                        </button>
                    </div>
                    
                    <div id="imagePreview"></div>
                    
                    <button class="upload-btn" id="startAnalysis" style="display: none; margin-top: 24px;" onclick="startAnalysis()">
                        🤖 Start AI Analysis
                    </button>
                </div>
            </div>

            <!-- Step 3: Analysis Loading -->
            <div class="content-section hidden" id="analysisSection">
                <div class="loading">
                    <div class="ai-spinner"></div>
                    <h3>🧠 Analyzing Image...</h3>
                    <p>Processing <span id="analyzingFruit">fruit</span> with AI vision</p>
                    <div id="progressText">Initializing neural networks...</div>
                </div>
            </div>

            <!-- Step 4: Results -->
            <div class="content-section hidden" id="resultsSection">
                <div class="confidence-score">
                    <h3>🎯 Analysis Confidence</h3>
                    <div class="confidence-value" id="overallConfidence">94%</div>
                    <p>High-precision quality assessment</p>
                </div>

                <div class="metrics-dashboard">
                    <div class="metric-card">
                        <span class="metric-icon">🌿</span>
                        <div class="metric-label">Freshness Score</div>
                        <div class="metric-value" id="freshnessValue">87%</div>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="freshnessBar" style="background: linear-gradient(90deg, #4caf50, #2e7d32);"></div>
                            </div>
                        </div>
                        <span class="rating excellent" id="freshnessRating">Excellent</span>
                    </div>

                    <div class="metric-card">
                        <span class="metric-icon">🎨</span>
                        <div class="metric-label">Ripeness Level</div>
                        <div class="metric-value" id="ripenessValue">82%</div>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="ripenessBar" style="background: linear-gradient(90deg, #ff8e53, #ff6b6b);"></div>
                            </div>
                        </div>
                        <span class="rating good" id="ripenessRating">Good</span>
                    </div>

                    <div class="metric-card">
                        <span class="metric-icon">⏰</span>
                        <div class="metric-label">Shelf Life</div>
                        <div class="metric-value" id="shelfLifeValue">6 Days</div>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="shelfLifeBar" style="background: linear-gradient(90deg, #34c0eb, #1e88e5);"></div>
                            </div>
                        </div>
                        <span class="rating good" id="shelfLifeRating">Good</span>
                    </div>

                    <div class="metric-card">
                        <span class="metric-icon">💎</span>
                        <div class="metric-label">Quality Grade</div>
                        <div class="metric-value" id="qualityValue">A-</div>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="qualityBar" style="background: linear-gradient(90deg, #d81b60, #c2185b);"></div>
                            </div>
                        </div>
                        <span class="rating excellent" id="qualityRating">Premium</span>
                    </div>
                </div>

                <div class="analysis-section">
                    <div class="insights-panel">
                        <div class="insights-header">
                            <span style="font-size: 1.25rem;">🏪</span>
                            <h3>Storage & Handling</h3>
                        </div>
                        <div id="storageInsights"></div>
                    </div>

                    <div class="insights-panel">
                        <div class="insights-header">
                            <span style="font-size: 1.25rem;">💰</span>
                            <h3>Market Analysis</h3>
                        </div>
                        <div id="marketInsights"></div>
                    </div>
                </div>

                <div class="insights-panel">
                    <div class="insights-header">
                        <span style="font-size: 1.25rem;">📊</span>
                        <h3>Business Intelligence</h3>
                    </div>
                    <div id="businessInsights"></div>
                </div>

                <div style="text-align: center; margin-top: 24px;">
                    <button class="upload-btn" onclick="resetAnalysis()" style="background: linear-gradient(135deg, #6b7280, #4b5e5a);">
                        🔄 Analyze Another Fruit
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        window.selectedFruit = null;
        window.selectedCondition = null;
        window.currentStep = 1;
        window.uploadedImage = null;

        // Fruit database
        window.fruitDatabase = {
            apple: {
                icon: '🍎',
                name: 'Apple',
                varieties: ['Red Delicious', 'Granny Smith', 'Gala', 'Fuji', 'Honeycrisp', 'Golden Delicious'],
                description: 'Crisp texture, various colors',
                avgShelfLife: 30,
                optimalTemp: '0-4°C',
                optimalHumidity: '90-95%',
                peakRipeness: 85,
                qualityFactors: {
                    firmness: 0.3,
                    color: 0.25,
                    skin: 0.25,
                    shape: 0.2
                },
                priceRange: { premium: 150, standard: 100, discount: 60 }
            },
            banana: {
                icon: '🍌',
                name: 'Banana',
                varieties: ['Cavendish', 'Lady Finger', 'Red Banana', 'Plantain'],
                description: 'Curved yellow fruit',
                avgShelfLife: 7,
                optimalTemp: '13-15°C',
                optimalHumidity: '85-90%',
                peakRipeness: 75,
                qualityFactors: {
                    color: 0.4,
                    spots: 0.3,
                    firmness: 0.2,
                    shape: 0.1
                },
                priceRange: { premium: 80, standard: 50, discount: 30 }
            },
            orange: {
                icon: '🍊',
                name: 'Orange',
                varieties: ['Navel', 'Valencia', 'Blood Orange', 'Mandarin'],
                description: 'Citrus with thick skin',
                avgShelfLife: 21,
                optimalTemp: '0-4°C',
                optimalHumidity: '85-90%',
                peakRipeness: 90,
                qualityFactors: {
                    color: 0.3,
                    firmness: 0.3,
                    skin: 0.25,
                    weight: 0.15
                },
                priceRange: { premium: 120, standard: 80, discount: 45 }
            },
            strawberry: {
                icon: '🍓',
                name: 'Strawberry',
                varieties: ['Albion', 'Seascape', 'Chandler', 'Festival'],
                description: 'Small red berries',
                avgShelfLife: 5,
                optimalTemp: '0-2°C',
                optimalHumidity: '90-95%',
                peakRipeness: 95,
                qualityFactors: {
                    color: 0.35,
                    firmness: 0.35,
                    surface: 0.2,
                    size: 0.1
                },
                priceRange: { premium: 300, standard: 200, discount: 120 }
            },
            grape: {
                icon: '🍇',
                name: 'Grape',
                varieties: ['Red Globe', 'Thompson Seedless', 'Flame Seedless', 'Black Beauty'],
                description: 'Clustered small fruits',
                avgShelfLife: 14,
                optimalTemp: '-1-0°C',
                optimalHumidity: '90-95%',
                peakRipeness: 88,
                qualityFactors: {
                    firmness: 0.3,
                    color: 0.25,
                    cluster: 0.25,
                    bloom: 0.2
                },
                priceRange: { premium: 250, standard: 150, discount: 90 }
            },
            mango: {
                icon: '🥭',
                name: 'Mango',
                varieties: ['Alphonso', 'Tommy Atkins', 'Kent', 'Haden'],
                description: 'Tropical stone fruit',
                avgShelfLife: 10,
                optimalTemp: '10-13°C',
                optimalHumidity: '85-90%',
                peakRipeness: 80,
                qualityFactors: {
                    color: 0.3,
                    firmness: 0.3,
                    aroma: 0.25,
                    skin: 0.15
                },
                priceRange: { premium: 200, standard: 120, discount: 70 }
            }
        };

        // Initialize the application
        function initializeApp() {
            console.log('Initializing app...');
            renderFruitGrid();
            updateStepIndicator();
            console.log('App initialized successfully');
        }

        // Render fruit grid dynamically
        function renderFruitGrid() {
            const grid = document.getElementById('fruitGrid');
            if (!grid) {
                console.error('Fruit grid element not found');
                return;
            }
            
            grid.innerHTML = '';
            
            Object.entries(window.fruitDatabase).forEach(([key, fruit]) => {
                const fruitOption = document.createElement('div');
                fruitOption.className = 'fruit-option';
                fruitOption.setAttribute('data-fruit', key);
                fruitOption.onclick = () => selectFruit(key);
                
                fruitOption.innerHTML = `
                    <span class="fruit-icon">${fruit.icon}</span>
                    <div class="fruit-name">${fruit.name}</div>
                    <div class="fruit-desc">${fruit.description}</div>
                `;
                
                grid.appendChild(fruitOption);
            });
            
            console.log('Fruit grid rendered with', Object.keys(window.fruitDatabase).length, 'options');
        }

        // Select fruit and show condition selector
        window.selectFruit = function(fruitKey) {
            console.log('Selecting fruit:', fruitKey);
            
            // Remove previous selection
            document.querySelectorAll('.fruit-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selection to clicked fruit
            const clickedOption = document.querySelector(`[data-fruit="${fruitKey}"]`);
            if (clickedOption) {
                clickedOption.classList.add('selected');
            }
            
            window.selectedFruit = fruitKey;
            window.selectedCondition = null; // Reset condition
            document.querySelectorAll('.condition-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Show condition selector
            document.getElementById('conditionSelector').style.display = 'block';
            
            // Update text elements
            const selectedFruitNameEl = document.getElementById('selectedFruitName');
            const analyzingFruitEl = document.getElementById('analyzingFruit');
            
            if (selectedFruitNameEl) selectedFruitNameEl.textContent = window.fruitDatabase[fruitKey].name.toLowerCase();
            if (analyzingFruitEl) analyzingFruitEl.textContent = window.fruitDatabase[fruitKey].name.toLowerCase();
        };

        // Select condition
        window.selectCondition = function(condition) {
            console.log('Selecting condition:', condition);
            
            // Remove previous selection
            document.querySelectorAll('.condition-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection to clicked condition
            const clickedCard = document.querySelector(`[data-condition="${condition}"]`);
            if (clickedCard) {
                clickedCard.classList.add('selected');
            }
            
            window.selectedCondition = condition;
            
            // Show proceed button only if both fruit and condition are selected
            if (window.selectedFruit && window.selectedCondition) {
                document.getElementById('proceedToUpload').style.display = 'inline-block';
            }
        };

        // Proceed to step 2
        window.proceedToStep2 = function() {
            if (!window.selectedFruit || !window.selectedCondition) {
                alert('Please select both a fruit and its condition before proceeding.');
                return;
            }
            
            window.currentStep = 2;
            updateStepIndicator();
            showSection('imageUploadSection');
        };

        // Update step indicator
        function updateStepIndicator() {
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById(`step${i}`);
                if (step) {
                    step.classList.remove('active', 'completed');
                    
                    if (i < window.currentStep) {
                        step.classList.add('completed');
                    } else if (i === window.currentStep) {
                        step.classList.add('active');
                    }
                }
            }
        }

        // Show specific section
        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('hidden');
            });
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
        }

        // Handle file selection
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                processImage(file);
            } else {
                alert('Please select a valid image file.');
            }
        }

        // Process uploaded image
        function processImage(file) {
            window.uploadedImage = file;
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const preview = document.getElementById('imagePreview');
                if (preview) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Uploaded ${window.selectedFruit}" class="image-preview">`;
                }
                const startBtn = document.getElementById('startAnalysis');
                if (startBtn) {
                    startBtn.style.display = 'inline-block';
                }
            };
            
            reader.readAsDataURL(file);
        }

        // Capture image using camera
        window.captureImage = function() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(function(stream) {
                        alert('Camera access granted! In production, this would capture and process the image directly.');
                        stream.getTracks().forEach(track => track.stop());
                    })
                    .catch(function(err) {
                        alert('Camera not available. Please use the gallery option to select an image.');
                    });
            } else {
                alert('Camera functionality not supported. Please select an image from your gallery.');
            }
        };

        // Start AI analysis
        window.startAnalysis = function() {
            if (!window.uploadedImage || !window.selectedFruit || !window.selectedCondition) {
                alert('Please select a fruit, its condition, and upload an image before starting analysis.');
                return;
            }
            
            window.currentStep = 3;
            updateStepIndicator();
            showSection('analysisSection');
            
            const stages = [
                "Preprocessing image data...",
                "Extracting visual features...",
                "Analyzing color patterns...",
                "Detecting surface defects...",
                "Measuring firmness indicators...",
                "Calculating ripeness metrics...",
                "Estimating shelf life...",
                "Generating quality score...",
                "Compiling business insights..."
            ];
            
            let stageIndex = 0;
            const progressText = document.getElementById('progressText');
            
            const stageInterval = setInterval(() => {
                if (stageIndex < stages.length) {
                    if (progressText) progressText.textContent = stages[stageIndex];
                    stageIndex++;
                } else {
                    clearInterval(stageInterval);
                    setTimeout(() => {
                        completeAnalysis();
                    }, 1000);
                }
            }, 800);
        };

        // Complete analysis and show results
        function completeAnalysis() {
            window.currentStep = 4;
            updateStepIndicator();
            showSection('resultsSection');
            
            const fruitData = window.fruitDatabase[window.selectedFruit];
            const analysis = generateRealisticAnalysis(fruitData);
            
            updateResultsDisplay(analysis);
        }

        // Generate realistic analysis based on fruit and condition
        function generateRealisticAnalysis(fruitData) {
            let freshness, ripeness, shelfLife, confidence, qualityScore, qualityGrade;
            
            switch(window.selectedCondition) {
                case 'fresh':
                    freshness = Math.round(85 + Math.random() * 15);
                    ripeness = Math.round(Math.max(70, Math.min(95, fruitData.peakRipeness + (Math.random() - 0.5) * 15)));
                    shelfLife = Math.round(fruitData.avgShelfLife * (0.9 + Math.random() * 0.1));
                    confidence = Math.round(88 + Math.random() * 12);
                    break;
                    
                case 'aging':
                    freshness = Math.round(60 + Math.random() * 25);
                    ripeness = Math.round(Math.max(80, Math.min(100, fruitData.peakRipeness + (Math.random() * 20))));
                    shelfLife = Math.round(fruitData.avgShelfLife * (0.3 + Math.random() * 0.4));
                    confidence = Math.round(82 + Math.random() * 10);
                    break;
                    
                case 'stale':
                    freshness = Math.round(25 + Math.random() * 35);
                    ripeness = Math.round(Math.max(90, Math.min(100, 95 + Math.random() * 5)));
                    shelfLife = Math.round(fruitData.avgShelfLife * (0.1 + Math.random() * 0.2));
                    confidence = Math.round(75 + Math.random() * 15);
                    break;
                    
                case 'rotten':
                    freshness = Math.round(5 + Math.random() * 20);
                    ripeness = 100;
                    shelfLife = Math.round(0 + Math.random() * 2);
                    confidence = Math.round(90 + Math.random() * 10);
                    break;
                    
                default:
                    freshness = Math.round(60 + Math.random() * 25);
                    ripeness = Math.round(fruitData.peakRipeness);
                    shelfLife = Math.round(fruitData.avgShelfLife * 0.5);
                    confidence = 85;
            }
            
            qualityScore = (freshness * 0.5) + (Math.min(ripeness, 90) * 0.3) + (confidence * 0.2);
            
            if (window.selectedCondition === 'rotten') {
                qualityGrade = 'F';
            } else if (window.selectedCondition === 'stale') {
                qualityGrade = freshness > 50 ? 'D+' : 'D';
            } else if (qualityScore >= 90) qualityGrade = 'A+';
            else if (qualityScore >= 85) qualityGrade = 'A';
            else if (qualityScore >= 80) qualityGrade = 'A-';
            else if (qualityScore >= 75) qualityGrade = 'B+';
            else if (qualityScore >= 70) qualityGrade = 'B';
            else if (qualityScore >= 60) qualityGrade = 'C';
            else qualityGrade = 'D';
            
            return {
                freshness,
                ripeness,
                shelfLife: Math.max(0, shelfLife),
                confidence,
                qualityGrade,
                qualityScore,
                fruitData,
                condition: window.selectedCondition,
                variety: fruitData.varieties[Math.floor(Math.random() * fruitData.varieties.length)]
            };
        }

        // Update results display
        function updateResultsDisplay(analysis) {
            const { freshness, ripeness, shelfLife, confidence, qualityGrade, fruitData, condition } = analysis;
            
            // Add warning banners for bad conditions
            const resultsSection = document.getElementById('resultsSection');
            let warningBanner = '';
            
            if (condition === 'rotten') {
                warningBanner = `
                    <div class="danger-banner">
                        <h2>⚠️ DANGER - DO NOT CONSUME ⚠️</h2>
                        <p><strong>This fruit is completely spoiled and potentially harmful!</strong></p>
                        <p>Consuming rotten fruit can cause food poisoning, stomach issues, and serious health problems.</p>
                        <p><strong>Recommendation: DISCARD IMMEDIATELY</strong></p>
                    </div>
                `;
            } else if (condition === 'stale') {
                warningBanner = `
                    <div class="warning-banner">
                        <h3>⚠️ WARNING - POOR QUALITY</h3>
                        <p><strong>This fruit is past its prime and not recommended for consumption.</strong></p>
                        <p>May cause digestive discomfort. Consider composting or disposal.</p>
                    </div>
                `;
            }
            
            if (warningBanner && resultsSection) {
                resultsSection.insertAdjacentHTML('afterbegin', warningBanner);
            }
            
            // Update confidence score
            const overallConfidence = document.getElementById('overallConfidence');
            if (overallConfidence) overallConfidence.textContent = confidence + '%';
            
            // Update metrics with animations
            setTimeout(() => updateMetricCard('freshness', freshness), 200);
            setTimeout(() => updateMetricCard('ripeness', ripeness), 400);
            setTimeout(() => updateShelfLife(shelfLife, fruitData.avgShelfLife), 600);
            setTimeout(() => updateQualityGrade(qualityGrade, analysis.qualityScore), 800);
            
            // Generate insights
            setTimeout(() => generateStorageInsights(analysis), 1000);
            setTimeout(() => generateMarketInsights(analysis), 1200);
            setTimeout(() => generateBusinessInsights(analysis), 1400);
        }

        // Update metric card
        function updateMetricCard(metric, value) {
            const valueEl = document.getElementById(metric + 'Value');
            const barEl = document.getElementById(metric + 'Bar');
            const ratingEl = document.getElementById(metric + 'Rating');
            
            if (valueEl) valueEl.textContent = value + '%';
            if (barEl) barEl.style.width = value + '%';
            
            const rating = getRating(value);
            if (ratingEl) {
                ratingEl.textContent = rating.text;
                ratingEl.className = `rating ${rating.class}`;
            }
        }

        // Update shelf life
        function updateShelfLife(days, avgDays) {
            const valueEl = document.getElementById('shelfLifeValue');
            const barEl = document.getElementById('shelfLifeBar');
            const ratingEl = document.getElementById('shelfLifeRating');
            
            if (valueEl) valueEl.textContent = days + ' Days';
            
            const percentage = Math.min(100, (days / avgDays) * 100);
            if (barEl) barEl.style.width = percentage + '%';
            
            const rating = getShelfLifeRating(days, avgDays);
            if (ratingEl) {
                ratingEl.textContent = rating.text;
                ratingEl.className = `rating ${rating.class}`;
            }
        }

        // Update quality grade
        function updateQualityGrade(grade, score) {
            const valueEl = document.getElementById('qualityValue');
            const barEl = document.getElementById('qualityBar');
            const ratingEl = document.getElementById('qualityRating');
            
            if (valueEl) valueEl.textContent = grade;
            if (barEl) barEl.style.width = score + '%';
            
            const rating = getQualityRating(grade);
            if (ratingEl) {
                ratingEl.textContent = rating.text;
                ratingEl.className = `rating ${rating.class}`;
            }
        }

        // Get rating based on value
        function getRating(value) {
            if (value >= 85) return { text: 'Excellent', class: 'excellent' };
            if (value >= 75) return { text: 'Good', class: 'good' };
            if (value >= 65) return { text: 'Average', class: 'average' };
            return { text: 'Poor', class: 'poor' };
        }

        // Get shelf life rating
        function getShelfLifeRating(days, avgDays) {
            const ratio = days / avgDays;
            if (ratio >= 0.8) return { text: 'Extended', class: 'excellent' };
            if (ratio >= 0.6) return { text: 'Good', class: 'good' };
            if (ratio >= 0.4) return { text: 'Limited', class: 'average' };
            return { text: 'Critical', class: 'poor' };
        }

        // Get quality rating
        function getQualityRating(grade) {
            if (grade.startsWith('A')) return { text: 'Premium', class: 'excellent' };
            if (grade.startsWith('B')) return { text: 'Standard', class: 'good' };
            return { text: 'Basic', class: 'average' };
        }

        // Generate storage insights
        function generateStorageInsights(analysis) {
            const { freshness, ripeness, shelfLife, fruitData, condition } = analysis;
            const insights = [];
            
            switch(condition) {
                case 'rotten':
                    insights.push({
                        title: '🚨 IMMEDIATE DISPOSAL REQUIRED',
                        description: 'This fruit is completely spoiled. Dispose of immediately to prevent contamination of other produce. Do not compost if moldy.'
                    });
                    insights.push({
                        title: '🧤 Safety Precautions',
                        description: 'Wear gloves when handling. Wash hands thoroughly. Clean any surfaces that came in contact with the spoiled fruit.'
                    });
                    insights.push({
                        title: '⚠️ Health Warning',
                        description: 'Consuming this fruit can cause severe food poisoning, nausea, vomiting, and diarrhea. Seek medical attention if accidentally consumed.'
                    });
                    break;
                    
                case 'stale':
                    insights.push({
                        title: '🗑️ Disposal Recommended',
                        description: 'This fruit is past safe consumption. Consider composting if no mold is present, or dispose of in organic waste.'
                    });
                    insights.push({
                        title: '⚠️ Not for Human Consumption',
                        description: 'Quality has deteriorated significantly. May cause digestive issues if consumed. Not suitable for retail or food service.'
                    });
                    insights.push({
                        title: '🔄 Prevention Tips',
                        description: 'In future, monitor fruit daily for early signs of deterioration. Improve storage conditions and rotation practices.'
                    });
                    break;
                    
                case 'aging':
                    insights.push({
                        title: '⚡ Quick Use Required',
                        description: 'Consume within 1-2 days or process immediately. Suitable for cooking, baking, or juice extraction rather than fresh consumption.'
                    });
                    insights.push({
                        title: '❄️ Immediate Refrigeration',
                        description: `Refrigerate at ${fruitData.optimalTemp} immediately to slow further deterioration. Keep separate from fresh produce.`
                    });
                    insights.push({
                        title: '💡 Alternative Uses',
                        description: 'Consider using for smoothies, jams, baked goods, or other processed applications where texture changes are acceptable.'
                    });
                    break;
                    
                default: // fresh
                    insights.push({
                        title: '🌡️ Optimal Storage Temperature',
                        description: `Store at ${fruitData.optimalTemp} with ${fruitData.optimalHumidity} humidity for maximum freshness retention.`
                    });
                    insights.push({
                        title: '📦 Premium Handling',
                        description: 'High-quality fruit suitable for premium packaging. Handle with care to maintain appearance and extend shelf life.'
                    });
                    break;
            }
            
            renderInsights('storageInsights', insights);
        }

        // Generate market insights
        function generateMarketInsights(analysis) {
            const { freshness, ripeness, shelfLife, fruitData, variety } = analysis;
            const insights = [];
            
            let priceCategory = 'premium';
            if (freshness < 70) priceCategory = 'discount';
            else if (freshness < 85) priceCategory = 'standard';
            
            const suggestedPrice = fruitData.priceRange[priceCategory];
            
            insights.push({
                title: '💰 Pricing Strategy',
                description: `Recommended price: ₹${suggestedPrice}/kg (${priceCategory} category). Current quality supports ${priceCategory} market positioning.`
            });
            
            if (shelfLife > 7) {
                insights.push({
                    title: '🚚 Distribution Potential',
                    description: 'Extended shelf life makes this suitable for long-distance shipping and export markets. Consider premium distribution channels.'
                });
            } else if (shelfLife > 3) {
                insights.push({
                    title: '🏪 Local Market Focus',
                    description: 'Good for regional distribution and retail chains. Recommend partnerships with local supermarkets and vendors.'
                });
            } else {
                insights.push({
                    title: '⚡ Quick Sale Required',
                    description: 'Limited shelf life requires immediate local sales or processing. Consider farm-direct sales or juice production.'
                });
            }
            
            insights.push({
                title: '🎯 Variety Analysis',
                description: `${variety} variety detected. This variety is known for ${getVarietyCharacteristics(window.selectedFruit, variety)}.`
            });
            
            renderInsights('marketInsights', insights);
        }

        // Generate business insights
        function generateBusinessInsights(analysis) {
            const { freshness, ripeness, shelfLife, confidence, fruitData } = analysis;
            const insights = [];
            
            insights.push({
                title: '📊 Inventory Priority',
                description: `${shelfLife <= 3 ? 'HIGH PRIORITY' : shelfLife <= 7 ? 'MEDIUM PRIORITY' : 'LOW PRIORITY'} - Rotate stock accordingly. First-in-first-out strategy recommended.`
            });
            
            if (confidence > 90) {
                insights.push({
                    title: '✅ Quality Assurance',
                    description: 'High-confidence analysis results. Current quality control processes are effective. Maintain current standards.'
                });
            } else {
                insights.push({
                    title: '🔍 Enhanced Monitoring',
                    description: 'Moderate confidence in analysis. Recommend additional manual inspection and enhanced quality control protocols.'
                });
            }
            
            const profitMargin = calculateProfitMargin(analysis);
            insights.push({
                title: '💼 Profit Optimization',
                description: `Estimated profit margin: ${profitMargin}%. ${profitMargin > 40 ? 'Excellent profitability' : profitMargin > 25 ? 'Good returns expected' : 'Consider cost optimization'}.`
            });
            
            insights.push({
                title: '🌱 Sustainability Score',
                description: `${shelfLife > fruitData.avgShelfLife * 0.7 ? 'Low food waste potential' : 'Higher waste risk'}. Consider ${freshness < 70 ? 'alternative processing' : 'extended storage'} options.`
            });
            
            renderInsights('businessInsights', insights);
        }

        // Render insights
        function renderInsights(containerId, insights) {
            const container = document.getElementById(containerId);
            if (container) {
                container.innerHTML = insights.map(insight => `
                    <div class="insight-item">
                        <div class="insight-title">${insight.title}</div>
                        <div class="insight-desc">${insight.description}</div>
                    </div>
                `).join('');
            }
        }

        // Get variety characteristics
        function getVarietyCharacteristics(fruit, variety) {
            const characteristics = {
                apple: {
                    'Red Delicious': 'sweet flavor and long storage life',
                    'Granny Smith': 'tart taste and excellent baking properties',
                    'Gala': 'mild sweetness and crisp texture',
                    'Fuji': 'exceptional sweetness and firm flesh',
                    'Honeycrisp': 'crisp texture and balanced sweet-tart flavor',
                    'Golden Delicious': 'mellow sweetness and soft texture'
                },
                banana: {
                    'Cavendish': 'reliable ripening and sweet flavor',
                    'Lady Finger': 'delicate texture and intense sweetness',
                    'Red Banana': 'unique appearance and raspberry notes',
                    'Plantain': 'starchy texture suitable for cooking'
                },
                orange: {
                    'Navel': 'sweet and seedless, ideal for fresh eating',
                    'Valencia': 'juicy and perfect for juicing',
                    'Blood Orange': 'distinctive red flesh and tart-sweet flavor',
                    'Mandarin': 'easy to peel and sweet'
                },
                strawberry: {
                    'Albion': 'firm texture and sweet flavor',
                    'Seascape': 'high yield and disease resistance',
                    'Chandler': 'large size and bright red color',
                    'Festival': 'firm and good for shipping'
                },
                grape: {
                    'Red Globe': 'large size and sweet flavor',
                    'Thompson Seedless': 'seedless and versatile',
                    'Flame Seedless': 'crisp and sweet',
                    'Black Beauty': 'rich flavor and deep color'
                },
                mango: {
                    'Alphonso': 'rich flavor and creamy texture',
                    'Tommy Atkins': 'vibrant color and firm flesh',
                    'Kent': 'sweet and juicy',
                    'Haden': 'aromatic and flavorful'
                }
            };
            
            return characteristics[fruit]?.[variety] || 'distinctive flavor and good market appeal';
        }

        // Calculate profit margin
        function calculateProfitMargin(analysis) {
            const { freshness, shelfLife } = analysis;
            let baseMargin = 30;
            
            if (freshness > 85) baseMargin += 15;
            else if (freshness < 70) baseMargin -= 10;
            
            if (shelfLife > 7) baseMargin += 10;
            else if (shelfLife < 3) baseMargin -= 15;
            
            return Math.max(5, Math.min(60, baseMargin));
        }

        // Reset analysis
        window.resetAnalysis = function() {
            window.currentStep = 1;
            window.selectedFruit = null;
            window.selectedCondition = null;
            window.uploadedImage = null;
            
            // Reset UI
            const proceedBtn = document.getElementById('proceedToUpload');
            const startBtn = document.getElementById('startAnalysis');
            const imagePreview = document.getElementById('imagePreview');
            const conditionSelector = document.getElementById('conditionSelector');
            
            if (proceedBtn) proceedBtn.style.display = 'none';
            if (startBtn) startBtn.style.display = 'none';
            if (imagePreview) imagePreview.innerHTML = '';
            if (conditionSelector) conditionSelector.style.display = 'none';
            
            // Clear selections
            document.querySelectorAll('.fruit-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelectorAll('.condition-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            updateStepIndicator();
            showSection('fruitSelectionSection');
        };

        // Initialize event listeners
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput) {
                fileInput.addEventListener('change', handleFileSelect);
            }
            
            const uploadSection = document.getElementById('uploadSection');
            if (uploadSection) {
                uploadSection.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadSection.classList.add('dragover');
                });
                
                uploadSection.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    uploadSection.classList.remove('dragover');
                });
                
                uploadSection.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadSection.classList.remove('dragover');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0 && files[0].type.startsWith('image/')) {
                        processImage(files[0]);
                    }
                });
            }
            
            initializeApp();
        });
    </script>
</body>
</html>